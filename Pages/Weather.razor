@page "/weather"
@rendermode InteractiveServer
@inject IJSRuntime JS

@using BlazorApp.Services.Weather
@using BlazorApp.Services.Weather.Forecasts;
@using WeatherForecastModel = BlazorApp.Services.Weather.Models.WeatherData

@using BlazorApp.Components.Services.Weather

<PageTitle>Weather</PageTitle>

<h1>Weather</h1>

<p>This component demonstrates showing data.</p>

@if (weatherData == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <button class="btn btn-primary mb-3" @onclick="LogForecasts">Log Forecasts to Console</button>

    <WeatherForecasts WeatherData="weatherData" />
}

@code {
    private WeatherForecastModel[]? weatherData;

    protected override void OnInitialized()
    {
        var forecastsService = new Forecasts();
        weatherData = forecastsService.GetAllForecasts()?.ToArray();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
       await LogForecasts();
    }

    private async Task LogForecasts()
    {
        if (weatherData != null)
        {
            await JS.InvokeVoidAsync("console.log", "=== Weather Forecasts ===");
            foreach (var f in weatherData)
            {
                await JS.InvokeVoidAsync("console.log", $"{f.Date}: {f.TemperatureC}°C - {f.Summary}");
            }
        }
    }
}
